# Qwen Chat Agent - 用户使用指南

## 应用简介

Qwen Chat Agent 是一个基于 LangChain 框架的 AI 对话助手桌面应用程序。它提供了现代化的图形用户界面，让您可以通过 OpenAPI 协议连接各种远程 AI 模型服务（如 OpenAI、Azure OpenAI 或自定义模型），进行智能对话交互。

### 主要功能

- **多模型支持**: 配置和管理多个 OpenAPI 兼容的 AI 模型，灵活切换
- **智能对话**: 支持多轮对话，AI 可以记住上下文信息
- **会话管理**: 创建、保存、加载和管理多个对话会话
- **文件操作**: AI 可以自动读取、修改和管理文件
- **文本处理**: 提供润色、扩写、缩写、翻译等文本处理功能
- **可视化界面**: 友好的图形界面，支持明暗主题切换
- **工具调用可视化**: 实时查看 AI 调用工具的过程和结果

---

## 安装和启动

### 系统要求

- **操作系统**: macOS 10.15+、Windows 10/11 或 Linux 主流发行版
- **Python 版本**: Python 3.9 或更高版本
- **网络连接**: 需要连接到 OpenAPI 模型服务

### 安装步骤

#### macOS / Linux

1. 打开终端，进入项目目录
2. 运行安装脚本：
   ```bash
   bash scripts/install.sh
   ```
3. 等待安装完成，脚本会自动：
   - 检查 Python 版本
   - 创建虚拟环境
   - 安装所有依赖包
   - 创建必要的目录结构
   - 生成默认配置文件

#### Windows

1. 打开命令提示符（CMD）或 PowerShell，进入项目目录
2. 运行安装脚本：
   ```cmd
   scripts\install.bat
   ```
3. 等待安装完成

### 启动应用

#### macOS / Linux

```bash
bash scripts/run.sh
```

#### Windows

```cmd
scripts\run.bat
```

或者直接运行：

```bash
# 激活虚拟环境后
python main.py
```

---

## 首次使用配置

### 添加第一个模型

首次启动应用时，系统会引导您添加第一个 AI 模型配置：

1. 应用启动后会显示"欢迎使用"对话框
2. 点击"添加模型"按钮
3. 在模型配置对话框中填写信息：
   - **模型名称**: 给模型起一个易识别的名称（如 "GPT-4"）
   - **API 端点**: 模型服务的 API 地址
   - **API 密钥**: 您的 API 密钥
   - **模型标识符**: 具体的模型名称（如 "gpt-4"）
4. 点击"保存"完成配置

---

## 模型配置指南

### 配置 OpenAI 模型

**示例配置：**

- **模型名称**: OpenAI GPT-4
- **API 端点**: `https://api.openai.com/v1`
- **API 密钥**: 您的 OpenAI API 密钥（从 https://platform.openai.com/api-keys 获取）
- **模型标识符**: `gpt-4` 或 `gpt-3.5-turbo`

### 配置 Azure OpenAI 模型

**示例配置：**

- **模型名称**: Azure GPT-4
- **API 端点**: `https://your-resource.openai.azure.com/`
- **API 密钥**: 您的 Azure OpenAI API 密钥
- **模型标识符**: 您在 Azure 中部署的模型名称

### 配置自定义 OpenAPI 兼容模型

如果您使用的是自定义的 OpenAPI 兼容服务（如本地部署的模型）：

- **模型名称**: 自定义名称
- **API 端点**: 您的服务地址（如 `http://localhost:8000/v1`）
- **API 密钥**: 服务要求的密钥（如果不需要可以填写任意值）
- **模型标识符**: 模型名称

### 管理多个模型

1. 点击工具栏的"设置"按钮
2. 在设置对话框中可以：
   - 查看所有已配置的模型列表
   - 添加新模型（点击"添加模型"按钮）
   - 编辑现有模型（选中后点击"编辑"按钮）
   - 删除模型（选中后点击"删除"按钮）
   - 切换当前使用的模型（从下拉菜单选择）

---

## 基本操作说明

### 创建会话

会话是一组相关对话的集合，每个会话独立保存。

**创建新会话：**

1. 点击工具栏的"新建会话"按钮（或按 `Ctrl+N`）
2. 在弹出的对话框中输入会话名称
3. 点击"确定"创建会话

**提示**: 如果不输入名称，系统会自动生成一个带时间戳的默认名称。

### 发送消息

1. 在底部的消息输入框中输入您的问题或指令
2. 点击"发送"按钮（或按 `Ctrl+Enter`）
3. AI 会开始生成响应，您可以看到流式显示的回复

**消息显示：**
- 您的消息显示在右侧，使用蓝色气泡
- AI 的回复显示在左侧，使用灰色气泡

### 切换会话

1. 在左侧的会话列表中点击任意会话
2. 主对话区域会加载该会话的完整历史记录
3. 您可以继续在该会话中对话

**会话列表显示：**
- 会话名称
- 创建时间
- 最新消息预览

### 切换模型

**方法 1: 通过设置对话框**
1. 点击工具栏的"设置"按钮
2. 在"当前使用模型"下拉菜单中选择新模型
3. 点击"保存"

**方法 2: 通过状态栏**
- 底部状态栏显示当前使用的模型名称
- 可以快速了解当前使用的是哪个模型

**注意**: 切换模型后，新的对话会使用新模型，但不会影响已有的会话历史。

### 调整模型参数

在设置对话框中可以调整：

- **温度参数** (0.0 - 2.0): 控制回复的随机性
  - 较低的值（如 0.3）：更确定、更一致的回复
  - 较高的值（如 1.5）：更有创意、更多样化的回复
  
- **最大长度** (512 - 4096): 控制回复的最大 token 数
  - 较小的值：更简短的回复，响应更快
  - 较大的值：更详细的回复，但可能更慢

---

## 文件操作说明

### 文件浏览器

右侧的文件浏览器显示当前工作目录的文件树结构。

**切换工作目录：**
1. 点击文件浏览器顶部的"选择目录"按钮
2. 在弹出的对话框中选择新目录
3. 文件浏览器会更新显示新目录的内容

**查看文件内容：**
- 双击文件浏览器中的任意文件
- 会在弹出窗口中显示文件的完整内容

### 让 AI 读取文件

**方法 1: 右键菜单**
1. 在文件浏览器中右键点击文件
2. 选择"让 AI 阅读"
3. AI 会自动读取文件内容并在对话中引用

**方法 2: 拖拽文件**
1. 从文件浏览器拖拽文件到对话区域
2. AI 会自动读取文件内容

**方法 3: 直接询问**
- 在对话中直接说："请读取 README.md 文件"
- AI 会自动调用文件读取工具

### 让 AI 修改文件

**方法 1: 右键菜单**
1. 在文件浏览器中右键点击文件
2. 选择"让 AI 修改"
3. 在对话中说明您想要的修改

**方法 2: 直接指令**
- 在对话中说："请修改 config.yaml 文件，将温度参数改为 0.8"
- AI 会自动调用文件修改工具

**查看修改差异：**
- 当 AI 修改文件后，会在回复中显示"查看差异"按钮
- 点击按钮可以看到修改前后的对比

### AI 自动文件操作

AI 可以根据您的需求自动执行文件操作，无需手动操作：

- **读取文件**: "帮我看看 main.py 里的代码"
- **创建文件**: "创建一个名为 test.txt 的文件，内容是..."
- **修改文件**: "把 README.md 中的版本号改为 2.0"
- **列出文件**: "列出当前目录下的所有 Python 文件"

**工具调用可视化：**
- 当 AI 调用工具时，对话区域会显示特殊样式的工具调用消息
- 包含工具名称、参数和执行结果
- 帮助您了解 AI 正在做什么

---

## 文本处理功能

### 使用浮动工具栏

1. 在对话区域选中任意文本
2. 会出现浮动工具栏，包含以下按钮：
   - **润色**: 改善文本的表达和流畅度
   - **扩写**: 扩展文本内容，增加细节
   - **缩写**: 压缩文本，保留核心信息
   - **翻译**: 翻译文本到其他语言
3. 点击相应按钮，AI 会自动处理选中的文本

### 使用文本处理菜单

1. 在消息输入框上方有文本处理功能下拉菜单
2. 选择一个功能（如"润色"）
3. 输入框会自动填充对应的提示模板
4. 您可以在模板基础上添加具体内容

---

## 会话管理

### 会话操作

**重命名会话：**
1. 右键点击会话列表中的会话
2. 选择"重命名"
3. 输入新名称

**删除会话：**
1. 右键点击会话列表中的会话
2. 选择"删除会话"
3. 确认删除

**会话回滚：**
1. 右键点击对话中的某条消息
2. 选择"回滚到此处"
3. 该消息之后的所有消息会被标记为半透明（已回滚状态）

### 自动保存

- 系统会自动保存您的对话
- 每次发送消息或收到回复后都会保存
- 无需手动保存，关闭应用后会话不会丢失

### 会话存储位置

所有会话保存在 `sessions/` 目录下：
- 每个会话有独立的目录
- 包含 `metadata.json`（会话信息）和 `messages.json`（消息历史）
- 可以手动备份或迁移会话文件

---

## 界面和主题

### 主题切换

1. 点击工具栏的"设置"按钮
2. 在主题选项中选择：
   - **明亮主题**: 适合白天使用
   - **暗黑主题**: 适合夜间使用
3. 点击"保存"，主题会立即生效（无需重启）

### 键盘快捷键

- `Ctrl+N`: 创建新会话
- `Ctrl+S`: 保存当前会话
- `Ctrl+Enter`: 发送消息

### 窗口布局

应用采用三栏布局：
- **左侧**: 会话列表
- **中间**: 对话区域和消息输入框
- **右侧**: 文件浏览器

您可以拖动分隔线调整各区域的大小。

---

## 常见问题解答（FAQ）

### Q1: 首次启动时提示"未配置模型"怎么办？

**A**: 这是正常的，首次使用需要添加模型配置。按照引导对话框的提示添加您的第一个 AI 模型即可。

### Q2: 提示"模型连接失败"怎么办？

**A**: 请检查：
1. API 端点地址是否正确
2. API 密钥是否有效
3. 网络连接是否正常
4. 模型服务是否可用

您可以点击"重试"按钮重新连接，或选择其他模型。

### Q3: 如何备份我的会话？

**A**: 所有会话保存在 `sessions/` 目录下，您可以：
- 直接复制整个 `sessions/` 目录进行备份
- 将备份的目录复制回来即可恢复会话

### Q4: AI 无法读取某些文件怎么办？

**A**: 系统对文件操作有以下限制：
- 文件大小不能超过 10MB
- 文件必须在当前工作目录内
- 某些二进制文件格式可能不支持

请确保文件符合这些要求。

### Q5: 如何让 AI 访问其他目录的文件？

**A**: 在文件浏览器中点击"选择目录"按钮，切换到目标目录即可。

### Q6: 会话历史会保留多久？

**A**: 会话历史会永久保存，除非您手动删除。默认每个会话最多保留 100 条消息（可在配置文件中修改）。

### Q7: 可以同时使用多个模型吗？

**A**: 可以配置多个模型，但同一时间只能使用一个模型进行对话。您可以随时切换模型。

### Q8: 切换模型后之前的会话会受影响吗？

**A**: 不会。切换模型只影响新的对话，已有的会话历史不会改变。

### Q9: 如何查看应用日志？

**A**: 
1. 点击菜单栏的"查看日志"选项
2. 或直接打开 `logs/agent.log` 文件

日志包含应用运行的详细信息，有助于问题排查。

### Q10: 应用占用内存过大怎么办？

**A**: 
1. 关闭不需要的会话
2. 在设置中减小"最大长度"参数
3. 定期清理旧的会话文件

### Q11: 如何卸载应用？

**A**: 
1. 删除项目目录
2. 删除虚拟环境（如果单独创建）
3. 删除配置文件（如果需要）

### Q12: 支持哪些文本处理语言？

**A**: 文本处理功能（润色、扩写、缩写、翻译）支持的语言取决于您使用的 AI 模型。大多数主流模型支持中文、英文等多种语言。

---

## 获取帮助

如果您遇到问题或需要帮助：

1. 查看本用户指南的常见问题部分
2. 查看应用日志文件（`logs/agent.log`）
3. 查看开发者文档（`docs/DEVELOPER_GUIDE.md`）
4. 提交 Issue 到项目仓库

---

## 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。
