# gui/error_dialog.py 分析文档

## 1. 文件概述
- 文件路径：d:\core\color\color_agent\src\gui\error_dialog.py
- 所属模块：GUI
- 主要功能：提供统一的错误提示对话框，用于向用户显示错误信息和提供操作选项
- 技术栈：PyQt6

## 2. 核心实现

### 2.1 ErrorDialog 类
- **功能**：错误对话框管理类，提供静态方法用于显示不同类型的错误对话框
- **核心特性**：
  - 支持通用错误和特定类型错误的显示
  - 支持自定义按钮和回调函数
  - 支持显示详细错误信息
  - 提供统一的错误处理界面

### 2.2 主要方法

#### 2.2.1 通用错误对话框
- `show_error()`：显示通用错误对话框，支持自定义标题、消息、详细信息和按钮

#### 2.2.2 特定类型错误对话框
- `show_model_error()`：显示模型错误对话框，用于模型连接或调用失败，支持重试和切换模型操作
- `show_session_error()`：显示会话错误对话框，用于会话加载、保存或恢复失败
- `show_file_error()`：显示文件错误对话框，用于文件操作失败
- `show_network_error()`：显示网络错误对话框，用于网络连接失败或超时，支持重试操作
- `show_warning()`：显示警告对话框，用于显示不影响正常运行但需要用户注意的信息

## 3. 与其他模块的关系
- **依赖模块**：
  - `PyQt6`：GUI框架
  - `src.utils.errors`：错误类型定义
- **被依赖情况**：被其他GUI组件和后端模块调用，用于显示错误信息
- **交互方式**：通过静态方法调用，提供错误信息显示和用户交互

## 4. 代码结构
```python
"""
错误对话框模块

提供统一的错误提示对话框，用于向用户显示错误信息和提供操作选项。
支持不同类型的错误显示和自定义操作按钮。
"""

import logging
from typing import Optional, Callable
from PyQt6.QtWidgets import QMessageBox, QPushButton
from PyQt6.QtCore import Qt

from src.utils.errors import AgentError, ModelError, SessionError, FileError

logger = logging.getLogger(__name__)

class ErrorDialog:
    """
    错误对话框管理类
    
    提供静态方法用于显示不同类型的错误对话框，
    支持自定义按钮和回调函数。
    """
    
    @staticmethod
    def show_error(...):
        """显示通用错误对话框"""
        # 实现...
    
    @staticmethod
    def show_model_error(...):
        """显示模型错误对话框"""
        # 实现...
    
    @staticmethod
    def show_session_error(...):
        """显示会话错误对话框"""
        # 实现...
    
    @staticmethod
    def show_file_error(...):
        """显示文件错误对话框"""
        # 实现...
    
    @staticmethod
    def show_network_error(...):
        """显示网络错误对话框"""
        # 实现...
    
    @staticmethod
    def show_warning(...):
        """显示警告对话框"""
        # 实现...
```

## 5. 潜在问题或改进点

### 5.1 错误类型扩展
- **问题**：目前只支持几种特定类型的错误，可能无法覆盖所有场景
- **改进**：可以考虑添加更多特定类型的错误对话框，如API错误、配置错误等

### 5.2 国际化支持
- **问题**：错误消息和按钮文本是硬编码的，不支持国际化
- **改进**：实现国际化支持，根据用户的语言设置显示相应的文本

### 5.3 自定义样式
- **问题**：使用默认的QMessageBox样式，可能与应用的整体风格不一致
- **改进**：实现自定义的错误对话框样式，保持与应用整体风格的一致性

### 5.4 错误日志记录
- **问题**：虽然记录了错误日志，但缺乏统一的错误追踪机制
- **改进**：实现错误追踪ID，方便在日志中查找相关错误信息

### 5.5 用户反馈收集
- **问题**：缺乏错误反馈收集机制，无法获取用户在使用过程中遇到的问题
- **改进**：添加错误反馈功能，允许用户提交遇到的错误信息

## 6. 总结
该文件是Color Agent项目的错误对话框管理模块，提供了统一的错误处理界面和多样化的错误显示方式。它支持通用错误和特定类型错误的显示，并提供了自定义按钮和回调函数的功能，使用户能够在遇到错误时获得清晰的信息和适当的操作选项。该模块提高了应用的用户体验和可维护性，是项目中重要的UI组件之一。